services:
  api:
    build:
      context: ./api_service
      dockerfile: Dockerfile
    container_name: sgr-confluence-agent-api
    restart: unless-stopped
    ports:
      - "${API_PORT:-8020}:8020"
    volumes:
      - ../sgr_agent_core:/app/sgr_agent_core:ro
      - ../sgr_deep_research:/app/sgr_deep_research:ro
      - ../config.yaml:/app/config.yaml:ro
      - ../agents.yaml:/app/agents.yaml:ro
      - ../logging_config.yaml:/app/logging_config.yaml:ro
      - ../logs:/app/logs
      - ../reports:/app/reports
    environment:
      - API_PORT=8020
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - sgr-confluence-network

networks:
  sgr-confluence-network:
    driver: bridge
