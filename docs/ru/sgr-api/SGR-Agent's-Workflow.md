## üß∂ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞

–ù–∞ —Å–ª–µ–¥—É—é—â–µ–π –¥–∏–∞–≥—Ä–∞–º–º–µ –ø–æ–∫–∞–∑–∞–Ω –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å SGR –∞–≥–µ–Ω—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ —É—Ç–æ—á–Ω–µ–Ω–∏–π:

```mermaid
sequenceDiagram
    participant Client
    participant API as FastAPI Server
    participant Agent as SGR Agent
    participant LLM as LLM
    participant Tools as Research Tools

    Note over Client, Tools: SGR Agent Core - –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≥–µ–Ω—Ç–∞

    Client->>API: POST /v1/chat/completions<br/>{"model": "sgr_agent", "messages": [...]}

    API->>Agent: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π SGR Agent<br/>—Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID
    Note over Agent: –°–æ—Å—Ç–æ—è–Ω–∏–µ: INITED

    Agent->>Agent: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç<br/>–∏ –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

    loop –¶–∏–∫–ª —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π SGR (–º–∞–∫—Å. 6 —à–∞–≥–æ–≤)
        Agent->>Agent: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ<br/>—Ç–µ–∫—É—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        Agent->>LLM: –ó–∞–ø—Ä–æ—Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞<br/>—Å–æ —Å—Ö–µ–º–æ–π NextStep

        LLM-->>API: –ü–æ—Ç–æ–∫–æ–≤—ã–µ —á–∞–Ω–∫–∏
        API-->>Client: SSE –ø–æ—Ç–æ–∫ —Å<br/>agent_id –≤ –ø–æ–ª–µ model

        LLM->>Agent: –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç NextStep

        alt –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: Clarification
            Note over Agent: –°–æ—Å—Ç–æ—è–Ω–∏–µ: WAITING_FOR_CLARIFICATION
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è
            Tools->>API: –í–µ—Ä–Ω—É—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
            API-->>Client: –ü–æ—Ç–æ–∫ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

            Client->>API: POST /v1/chat/completions<br/>{"model": "agent_id", "messages": [...]}
            API->>Agent: provide_clarification()
            Note over Agent: –°–æ—Å—Ç–æ—è–Ω–∏–µ: RESEARCHING
            Agent->>Agent: –î–æ–±–∞–≤–∏—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç

        else –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: GeneratePlan
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–ª–∞–Ω–∞
            Tools->>Agent: –ü–ª–∞–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω

        else –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: WebSearch
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ–±-–ø–æ–∏—Å–∫
            Tools->>Tools: –í—ã–∑–æ–≤ Tavily API
            Tools->>Agent: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ + –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            Agent->>Agent: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏

        else –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: AdaptPlan
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø–ª–∞–Ω–∞
            Tools->>Agent: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

        else –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: CreateReport
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
            Tools->>Tools: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π<br/>–æ—Ç—á–µ—Ç —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
            Tools->>Agent: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

        else –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ReportCompletion
            Note over Agent: –°–æ—Å—Ç–æ—è–Ω–∏–µ: COMPLETED
            Agent->>Tools: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            Tools->>Agent: –°—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        end

        Agent->>Agent: –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤<br/>–∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
        API-->>Client: –ü–æ—Ç–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

        break –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
            Agent->>Agent: –ü—Ä–µ—Ä–≤–∞—Ç—å —Ü–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        end
    end

    Agent->>API: –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ—Ç–æ–∫
    API-->>Client: –ó–∞–∫—Ä—ã—Ç—å SSE –ø–æ—Ç–æ–∫

    Note over Client, Tools: –ê–≥–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º<br/>—á–µ—Ä–µ–∑ agent_id –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π
```

## ü§ñ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Schema-Guided Reasoning:

1. **ü§î Clarification** - —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏ –Ω–µ—è—Å–Ω–æ—Å—Ç–∏
2. **üìã Plan Generation** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
3. **üîç Web Search** - –ø–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
4. **üîÑ Plan Adaptation** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. **üìù Report Creation** - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
6. **‚úÖ Final Answer** - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
